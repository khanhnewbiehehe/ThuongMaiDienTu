@model ThuongMaiDienTu.ViewModels.SearchViewModel

@{
    ViewData["Title"] = "Tìm kiếm sản phẩm";
}

<div class="container-fluid my-3">
    <div class="row">
        <!-- Left Sidebar - Filter Options -->
        <div class="col-md-3">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">CATEGORY</h5>
                </div>
                <div class="card-body">
                    <form id="searchForm" asp-controller="Search" asp-action="Index" method="get">
                        <!-- Keep existing search parameters -->
                        <input type="hidden" name="page" value="1" />
                        <input type="hidden" name="pageSize" value="@Model.PageSize" />

                        <!-- Search Term -->
                        <div class="mb-3">
                            <div class="input-group">
                                <input type="text" class="form-control" name="searchTerm" value="@Model.SearchTerm" placeholder="Search for anything..." />
                                <button class="btn btn-outline-secondary" type="submit">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Categories -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Categories</label>
                            <div class="form-check">
                                <input class="form-check-input category-filter" type="radio" name="categoryId" id="category-0" value="0" @(Model.CategoryId == 0 ? "checked" : "")>
                                <label class="form-check-label" for="category-0">
                                    Tất cả
                                </label>
                            </div>
                            @foreach (var category in Model.Categories)
                            {
                                <div class="form-check">
                                    <input class="form-check-input category-filter" type="radio" name="categoryId" id="category-@category.Id" value="@category.Id" @(Model.CategoryId == category.Id ? "checked" : "")>
                                    <label class="form-check-label" for="category-@category.Id">
                                        @category.Name
                                    </label>
                                </div>
                            }
                        </div>                        <!-- Price Range -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">PRICE RANGE</label>                            <!-- Price range options as radio buttons -->
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input price-option" type="radio" name="priceOption" id="priceOption-all" value="all" checked>
                                    <label class="form-check-label" for="priceOption-all">Tất cả</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input price-option" type="radio" name="priceOption" id="priceOption-under500k" value="under500k">
                                    <label class="form-check-label" for="priceOption-under500k">Dưới 500.000₫</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input price-option" type="radio" name="priceOption" id="priceOption-500kto1m" value="500kto1m">
                                    <label class="form-check-label" for="priceOption-500kto1m">500.000₫ - 1.000.000₫</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input price-option" type="radio" name="priceOption" id="priceOption-1mto5m" value="1mto5m">
                                    <label class="form-check-label" for="priceOption-1mto5m">1.000.000₫ - 5.000.000₫</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input price-option" type="radio" name="priceOption" id="priceOption-above5m" value="above5m">
                                    <label class="form-check-label" for="priceOption-above5m">Trên 5.000.000₫</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input price-option" type="radio" name="priceOption" id="priceOption-custom" value="custom">
                                    <label class="form-check-label" for="priceOption-custom">Tùy chỉnh</label>
                                </div>
                            </div>

                            <!-- Range slider -->
                            <div id="price-range-slider" class="mb-3"></div>

                            <!-- Display selected range -->
                            <div class="d-flex justify-content-between mb-3 price-display">
                                <span id="price-min">0₫</span>
                                <span id="price-max">20.000.000₫</span>
                            </div>                            <!-- Hidden inputs to store values -->
                            <input type="hidden" name="minPrice" id="minPriceInput" value="@Model.MinPrice">
                            <input type="hidden" name="maxPrice" id="maxPriceInput" value="@(Model.MaxPrice == decimal.MaxValue ? "20000000" : Model.MaxPrice.ToString())">
                        </div>
                        
                        <!-- Status Filter -->
                        <div class="mb-3" id="statusFilterContainer">
                            <label class="form-label fw-bold">TRẠNG THÁI</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="status-all" checked>
                                <label class="form-check-label" for="status-all">
                                    Tất cả
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input status-filter" type="checkbox" name="LaunchGoing" id="status-ongoing" value="true" @(Model.LaunchGoing ? "checked" : "")>
                                <label class="form-check-label" for="status-ongoing">
                                    Đang diễn ra
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input status-filter" type="checkbox" name="LaunchFull" id="status-full" value="true" @(Model.LaunchFull ? "checked" : "")>
                                <label class="form-check-label" for="status-full">
                                    Đã đầy
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input status-filter" type="checkbox" name="LaunchEnded" id="status-ended" value="true" @(Model.LaunchEnded ? "checked" : "")>
                                <label class="form-check-label" for="status-ended">
                                    Kết thúc
                                </label>
                            </div>
                        </div>
                        
                        <!-- Apply Filter Button -->
                        <button type="submit" class="btn btn-primary mt-3 w-100">Áp dụng bộ lọc</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right Content - Product Listings -->
        <div class="col-md-9">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="m-0" id="results-count">@Model.Products.Count() Results found</h4>                <div class="d-flex align-items-center">
                    <span class="me-2">Sort by:</span>
                    <select class="form-select form-select-sm" id="sort-option" style="width: auto;">
                        <option value="low-to-high" selected>Price: Low to High</option>
                        <option value="high-to-low">Price: High to Low</option>
                    </select>
                </div>
            </div>

            <!-- Active Filters -->
            <div class="d-flex gap-2 mb-3 flex-wrap">
                <span class="badge bg-secondary">Active Filters:</span>
                @if (!string.IsNullOrEmpty(Model.SearchTerm))
                {
                    <span class="badge bg-light text-dark border">Search: @Model.SearchTerm <i class="bi bi-x"></i></span>
                }
                @if (Model.CategoryId > 0)
                {
                    var selectedCategory = Model.Categories.FirstOrDefault(c => c.Id == Model.CategoryId);
                    if (selectedCategory != null)
                    {
                        <span class="badge bg-light text-dark border">Category: @selectedCategory.Name <i class="bi bi-x"></i></span>
                    }
                }                @if (Model.MinPrice > 0 || Model.MaxPrice < decimal.MaxValue)
                {
                    <span class="badge bg-light text-dark border">
                        Giá: @(Model.MinPrice > 0 ? Model.MinPrice.ToString("#,###") + "₫" : "0₫") -
                        @(Model.MaxPrice < decimal.MaxValue ? Model.MaxPrice.ToString("#,###") + "₫" : "20.000.000₫")
                        <i class="bi bi-x"></i>
                    </span>
                }
                @if (!Model.LaunchGoing || !Model.LaunchFull || !Model.LaunchEnded) // Updated property names
                {
                    <span class="badge bg-light text-dark border">
                        Trạng thái: 
                        @{
                            var statuses = new List<string>();
                            if (Model.LaunchGoing) statuses.Add("Đang diễn ra");
                            if (Model.LaunchFull) statuses.Add("Đã đầy");
                            if (Model.LaunchEnded) statuses.Add("Kết thúc");
                            @string.Join(", ", statuses)
                        }
                        <i class="bi bi-x"></i>
                    </span>
                }
            </div>            <!-- Products Grid -->
            <div id="list_search_product">
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.css">
    <link rel="stylesheet" href="~/css/price-slider.css" />
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.js"></script>
    <script src="~/LoadData/LoadSearchProduct.js"></script>
    <script src="~/js/price-slider.js"></script>
    <script src="~/js/status-filter.js"></script>
    <script src="~/js/sort-products.js"></script>
}